{% extends "base.html" %}

{% block vueapp %}
<v-app id="app">
    <div>
        <v-snackbar v-model="snackbar" :bottom="y === 'bottom'" :left="x === 'left'" :multi-line="mode === 'multi-line'"
            :right="x === 'right'" :timeout="timeout" :top="y === 'top'" :vertical="mode === 'vertical'"
            :color="snackbar_color">
            [[ snackbar_text ]]
            <v-btn color="white" flat @click="snackbar = false">
                Close
            </v-btn>
        </v-snackbar>
        <template>
            <v-layout row wrap>
                <v-flex xs12 sm6 md2 ma-4>
                    <v-dialog ref="dialog" v-model="dialog_calendar" :return-value.sync="selected_date" persistent lazy
                        full-width width="290px">
                        <template v-slot:activator="{ on }">
                            <v-text-field v-model="selected_date" label="Seleccionar fecha" prepend-icon="event"
                                readonly v-on="on">
                            </v-text-field>
                        </template>
                        <v-date-picker v-model="selected_date" scrollable>
                            <v-spacer></v-spacer>
                            <v-btn flat color="primary" @click="dialog_calendar = false">Cancel</v-btn>
                            <v-btn flat color="primary" @click="getCompanyHours">OK</v-btn>
                        </v-date-picker>
                    </v-dialog>

                    <v-dialog ref="dialog_event" v-model="dialog_event" scrollable max-width="600px">
                        <v-card>
                            <v-card-title><span class="headline">Agregar Evento</span></v-card-title>
                            <v-divider></v-divider>
                            <v-card-text style="height: 400px;">
                                <v-form method="post" id="eventForm" v-model="valid" lazy-validation ref="form">
                                    {% csrf_token %}
                                    <v-container grid-list-md>
                                        <v-layout wrap>
                                            <v-flex xs11 sm11 md11>
                                                <v-select ref="event_type" name="event_type" v-model="event_type"
                                                    :items="event_types" item-value="id" item-text="name"
                                                    label="Tipo Evento" :rules="requiredRule" required autofocus>
                                                    <template slot="item" slot-scope="data">
                                                        <v-list-tile-content>
                                                            <v-list-tile-title>
                                                                [[ data.item.name ]]
                                                            </v-list-tile-title>
                                                        </v-list-tile-content>
                                                    </template>
                                                </v-select>
                                            </v-flex>
                                            <v-flex xs11 sm11 md11>
                                                <v-autocomplete name="client" v-model="client" :items="clients"
                                                    :loading="isLoading" :search-input.sync="search" chips clearable
                                                    hide-details hide-selected item-text="dba" item-value="id"
                                                    label="Buscar Clientes..." :rules="requiredRule" required>
                                                    <template v-slot:no-data>
                                                        <v-list-tile>
                                                            <v-list-tile-title>
                                                                Buscar
                                                                <strong>Clientes</strong>
                                                            </v-list-tile-title>
                                                        </v-list-tile>
                                                    </template>

                                                    <template v-slot:selection="{ item, selected }">
                                                        <v-chip :selected="selected" color="blue-grey"
                                                            class="white--text">
                                                            <span v-text="item.dba"></span>
                                                        </v-chip>
                                                    </template>

                                                    <template v-slot:item="{ item }">
                                                        <v-list-tile-avatar color="indigo"
                                                            class="headline font-weight-light white--text">
                                                            [[ item.dba.charAt(0) ]]
                                                        </v-list-tile-avatar>
                                                        <v-list-tile-content>
                                                            <v-list-tile-title v-text="item.dba"></v-list-tile-title>
                                                            <v-list-tile-sub-title v-text="item.rfc">
                                                            </v-list-tile-sub-title>
                                                        </v-list-tile-content>
                                                    </template>
                                                </v-autocomplete>
                                            </v-flex>

                                            <v-flex xs11 sm6>
                                                <v-dialog ref="StartHour" v-model="dialog_start_hour"
                                                    :return-value.sync="start_time" persistent lazy full-width
                                                    width="290px">

                                                    <template v-slot:activator="{ on }">
                                                        <v-text-field name="start_time" v-model="start_time"
                                                            label="Hora inicio" prepend-icon="access_time" readonly
                                                            v-on="on" :rules="requiredRule" required>
                                                        </v-text-field>
                                                    </template>

                                                    <v-time-picker v-if="dialog_start_hour" v-model="start_time"
                                                        full-width>
                                                        <v-spacer></v-spacer>
                                                        <v-btn flat color="primary" @click="dialog_start_hour = false">
                                                            Cancel
                                                        </v-btn>
                                                        <v-btn flat color="primary"
                                                            @click="$refs.StartHour.save(start_time)">OK
                                                        </v-btn>
                                                    </v-time-picker>
                                                </v-dialog>
                                            </v-flex>

                                            <v-flex xs11 sm5>
                                                <v-dialog ref="EndHour" v-model="dialog_end_hour"
                                                    :return-value.sync="end_time" persistent lazy full-width
                                                    width="290px">
                                                    <template v-slot:activator="{ on }">
                                                        <v-text-field name="end_time" v-model="end_time"
                                                            label="Hora fin" prepend-icon="access_time" readonly
                                                            v-on="on" :rules="requiredRule" required>
                                                        </v-text-field>
                                                    </template>
                                                    <v-time-picker v-if="dialog_end_hour" v-model="end_time" full-width>
                                                        <v-spacer></v-spacer>
                                                        <v-btn flat color="primary" @click="dialog_end_hour = false">
                                                            Cancel
                                                        </v-btn>
                                                        <v-btn flat color="primary"
                                                            @click="$refs.EndHour.save(end_time)">OK
                                                        </v-btn>
                                                    </v-time-picker>
                                                </v-dialog>
                                            </v-flex>

                                            <v-flex xs11 sm11 md11>
                                                <v-textarea name="event_description" v-model="event_description"
                                                    label="Descripción del evento" value="" hint="" rows="2" required
                                                    :rules="requiredRule"></v-textarea>
                                            </v-flex>

                                            <v-flex xs11 sm11 md11>
                                                <v-autocomplete name="user" v-model="user" :items="users"
                                                    :loading="isLoading" :search-input.sync="searchUsers" chips multiple
                                                    clearable hide-details hide-selected item-text="username"
                                                    item-value="id" label="Buscar Empleados..." :rules="requiredRule"
                                                    required>
                                                    <template v-slot:no-data>
                                                        <v-list-tile>
                                                            <v-list-tile-title>
                                                                Buscar
                                                                <strong>Empleados</strong>
                                                            </v-list-tile-title>
                                                        </v-list-tile>
                                                    </template>

                                                    <template v-slot:selection="{ item, selected }">
                                                        <v-chip :selected="selected" color="blue-grey"
                                                            class="white--text">
                                                            <span v-text="item.username"></span>
                                                        </v-chip>
                                                    </template>

                                                    <template v-slot:item="{ item }">
                                                        <v-list-tile-avatar color="indigo"
                                                            class="headline font-weight-light white--text">
                                                            [[ item.username.charAt(0) ]]
                                                        </v-list-tile-avatar>
                                                        <v-list-tile-content>
                                                            <v-list-tile-title v-text="item.username">
                                                            </v-list-tile-title>
                                                            <v-list-tile-sub-title
                                                                v-text="item.first_name + ' ' +item.last_name">
                                                            </v-list-tile-sub-title>
                                                        </v-list-tile-content>
                                                    </template>
                                                </v-autocomplete>
                                            </v-flex>
                                        </v-layout>
                                    </v-container>
                                </v-form>
                            </v-card-text>
                            <v-divider></v-divider>
                            <v-card-actions>
                                <v-spacer></v-spacer>
                                <v-btn color="blue darken-1" flat @click="dialog_event = false">Cancelar</v-btn>
                                <!-- <v-btn color="blue darken-1" flat @click="resetForm">Limpiar</v-btn> -->
                                <v-btn color="blue darken-1" flat @click="saveEvent" :disabled="!valid">Guardar
                                </v-btn>
                            </v-card-actions>
                        </v-card>
                    </v-dialog>

                    <v-dialog ref="dialog_event_edit" v-model="dialog_event_edit" scrollable max-width="600px">
                        <v-card>
                            <v-card-title><span class="headline">Editar Evento</span></v-card-title>
                            <v-divider></v-divider>
                            <v-card-text style="height: 400px;">
                                <v-form method="post" id="eventEditForm" v-model="valid" lazy-validation ref="editForm">
                                    {% csrf_token %}
                                    <v-container grid-list-md>
                                        <v-layout wrap>


                                            <v-flex xs11 sm11 md11>
                                                <v-dialog ref="dialog_edit" v-model="dialog_calendar_edit"
                                                    :return-value.sync="selected_date_edit" persistent lazy full-width
                                                    width="290px">
                                                    <template v-slot:activator="{ on }">
                                                        <v-text-field v-model="selected_date_edit"
                                                            label="Seleccionar fecha" prepend-icon="event" readonly
                                                            v-on="on">
                                                        </v-text-field>
                                                    </template>
                                                    <v-date-picker v-model="selected_date_edit" scrollable>
                                                        <v-spacer></v-spacer>
                                                        <v-btn flat color="primary"
                                                            @click="dialog_calendar_edit = false">Cancel</v-btn>
                                                        <v-btn flat color="primary"
                                                            @click="$refs.dialog_edit.save(selected_date_edit)">OK
                                                        </v-btn>
                                                    </v-date-picker>
                                                </v-dialog>
                                            </v-flex>



                                            <v-flex xs11 sm11 md11>
                                                <v-select ref="edit_event_type" name="edit_event_type"
                                                    v-model="editedItem.event_type" :items="event_types" item-value="id"
                                                    item-text="name" label="Tipo Evento" :rules="requiredRule" required
                                                    autofocus>
                                                    <template slot="item" slot-scope="data">
                                                        <v-list-tile-content>
                                                            <v-list-tile-title>
                                                                [[ data.item.name ]]
                                                            </v-list-tile-title>
                                                        </v-list-tile-content>
                                                    </template>
                                                </v-select>
                                            </v-flex>

                                            <v-flex xs11 sm11 md11>
                                                <v-autocomplete name="edit_client" v-model="editedItem.client"
                                                    :items="clients" :loading="isLoading" :search-input.sync="search"
                                                    chips clearable hide-details hide-selected item-text="dba"
                                                    item-value="id" label="Buscar Clientes..." :rules="requiredRule"
                                                    required>
                                                    <template v-slot:no-data>
                                                        <v-list-tile>
                                                            <v-list-tile-title>
                                                                Buscar
                                                                <strong>Clientes</strong>
                                                            </v-list-tile-title>
                                                        </v-list-tile>
                                                    </template>

                                                    <template v-slot:selection="{ item, selected }">
                                                        <v-chip :selected="selected" color="blue-grey"
                                                            class="white--text">
                                                            <span v-text="item.dba"></span>
                                                        </v-chip>
                                                    </template>

                                                    <template v-slot:item="{ item }">
                                                        <v-list-tile-avatar color="indigo"
                                                            class="headline font-weight-light white--text">
                                                            [[ item.dba.charAt(0) ]]
                                                        </v-list-tile-avatar>
                                                        <v-list-tile-content>
                                                            <v-list-tile-title v-text="item.dba"></v-list-tile-title>
                                                            <v-list-tile-sub-title v-text="item.rfc">
                                                            </v-list-tile-sub-title>
                                                        </v-list-tile-content>
                                                    </template>
                                                </v-autocomplete>
                                            </v-flex>

                                            <v-flex xs11 sm6>
                                                <v-dialog ref="edit_StartHour" v-model="edit_dialog_start_hour"
                                                    :return-value.sync="edit_start_time" persistent lazy full-width
                                                    width="290px">

                                                    <template v-slot:activator="{ on }">
                                                        <v-text-field name="edit_start_time"
                                                            v-model="editedItem.start_hour" label="Hora inicio"
                                                            prepend-icon="access_time" readonly v-on="on"
                                                            :rules="requiredRule" required>
                                                        </v-text-field>
                                                    </template>

                                                    <v-time-picker v-if="edit_dialog_start_hour"
                                                        v-model="editedItem.start_hour" full-width>
                                                        <v-spacer></v-spacer>
                                                        <v-btn flat color="primary"
                                                            @click="edit_dialog_start_hour = false">
                                                            Cancel
                                                        </v-btn>
                                                        <v-btn flat color="primary"
                                                            @click="$refs.edit_StartHour.save(editedItem.start_hour)">OK
                                                        </v-btn>
                                                    </v-time-picker>
                                                </v-dialog>
                                            </v-flex>

                                            <v-flex xs11 sm5>
                                                <v-dialog ref="edit_EndHour" v-model="edit_dialog_end_hour"
                                                    :return-value.sync="edit_end_time" persistent lazy full-width
                                                    width="290px">
                                                    <template v-slot:activator="{ on }">
                                                        <v-text-field name="edit_end_time" v-model="editedItem.end_hour"
                                                            label="Hora fin" prepend-icon="access_time" readonly
                                                            v-on="on" :rules="requiredRule" required>
                                                        </v-text-field>
                                                    </template>
                                                    <v-time-picker v-if="edit_dialog_end_hour"
                                                        v-model="editedItem.end_hour" full-width>
                                                        <v-spacer></v-spacer>
                                                        <v-btn flat color="primary"
                                                            @click="edit_dialog_end_hour = false">
                                                            Cancel
                                                        </v-btn>
                                                        <v-btn flat color="primary"
                                                            @click="$refs.edit_EndHour.save(editedItem.end_hour)">OK
                                                        </v-btn>
                                                    </v-time-picker>
                                                </v-dialog>
                                            </v-flex>

                                            <v-flex xs11 sm11 md11>
                                                <v-textarea name="edit_event_description"
                                                    v-model="editedItem.description" label="Descripción del evento"
                                                    value="" hint="" rows="2" required :rules="requiredRule">
                                                </v-textarea>
                                            </v-flex>

                                            <v-flex xs11 sm11 md11>
                                                <v-autocomplete name="edit_user" v-model="editedItem.employees"
                                                    :items="users" :loading="isLoading" :search-input.sync="searchUsers"
                                                    chips multiple clearable hide-details hide-selected
                                                    item-text="username" item-value="id" label="Buscar Empleados..."
                                                    :rules="requiredRule" required>
                                                    <template v-slot:no-data>
                                                        <v-list-tile>
                                                            <v-list-tile-title>
                                                                Buscar
                                                                <strong>Empleados</strong>
                                                            </v-list-tile-title>
                                                        </v-list-tile>
                                                    </template>

                                                    <template v-slot:selection="{ item, selected }">
                                                        <v-chip :selected="selected" color="blue-grey"
                                                            class="white--text">
                                                            <span v-text="item.username"></span>
                                                        </v-chip>
                                                    </template>

                                                    <template v-slot:item="{ item }">
                                                        <v-list-tile-avatar color="indigo"
                                                            class="headline font-weight-light white--text">
                                                            [[ item.username.charAt(0) ]]
                                                        </v-list-tile-avatar>
                                                        <v-list-tile-content>
                                                            <v-list-tile-title v-text="item.username">
                                                            </v-list-tile-title>
                                                            <v-list-tile-sub-title
                                                                v-text="item.first_name + ' ' +item.last_name">
                                                            </v-list-tile-sub-title>
                                                        </v-list-tile-content>
                                                    </template>
                                                </v-autocomplete>
                                            </v-flex>

                                        </v-layout>
                                    </v-container>
                                </v-form>
                            </v-card-text>
                            <v-divider></v-divider>
                            <v-card-actions>
                                <v-spacer></v-spacer>
                                <v-btn color="blue darken-1" flat @click="dialog_event_edit = false">Cancelar</v-btn>
                                <v-btn color="blue darken-1" flat @click="updateEvent" :disabled="!valid">Guardar
                                </v-btn>
                            </v-card-actions>
                        </v-card>
                    </v-dialog>

                </v-flex>
            </v-layout>
        </template>

        <template>
            <v-container fluid grid-list-md>
                <v-data-iterator :items="work_days" :rows-per-page-items="rowsPerPageItems"
                    :pagination.sync="pagination" content-tag="v-layout" row wrap>
                    <template v-slot:item="props">
                        <v-flex xs12 sm6 md4 lg3>
                            <v-card>
                                <v-card-title>
                                    <v-btn color="blue darken-1" flat @click="ShowDialogEvents(props.item.date)">
                                        [[ props.item.date ]]
                                    </v-btn>
                                </v-card-title>
                                <v-divider></v-divider>
                                <v-list dense>
                                    <v-list-tile v-for="s in props.item.slots" :key="s.start">
                                        <v-list-tile-content style="font-size: x-small">
                                            [[ s.start ]] - [[ s.end ]]
                                        </v-list-tile-content>
                                        <v-list-tile-content v-for="e in s.events" :key="e.start">
                                            <v-menu transition="slide-x-transition" bottom right>
                                                <template v-slot:activator="{ on }">
                                                    <v-btn small round :color="e.status.color_class2"
                                                        style="height: auto; font-size: x-small" v-on="on">
                                                        ([[ e.id ]]) [[ e.client.dba ]] <br />([[ e.responsible_list ]])
                                                    </v-btn>
                                                </template>
                                                <v-list>
                                                    <v-list-tile v-for="(item, i) in actions" :key="i"
                                                        @click="EventAction(item.name, e)">
                                                        <v-list-tile-title>[[ item.title ]]</v-list-tile-title>
                                                    </v-list-tile>
                                                </v-list>
                                            </v-menu>
                                        </v-list-tile-content>
                                    </v-list-tile>
                                </v-list>
                            </v-card>
                        </v-flex>
                    </template>
                </v-data-iterator>
            </v-container>
        </template>
    </div>
</v-app>
{% endblock vueapp %}

{% block vuescript %}
<script>
    var app = new Vue({
        delimiters: ['[[', ']]'],
        el: '#app',
        data: {
            /*datasource*/
            work_days: [],
            event_types: [],
            users: [],
            clients: [],
            /*end datasource*/

            /*parameters*/
            valid: false,
            isLoading: false,
            search: null,
            searchUsers: null,
            rowsPerPageItems: [4, 8, 12],
            pagination: {
                rowsPerPage: 7
            },
            actions: [
                { title: 'Editar', name: 'EDIT' },
                { title: 'Cancelar', name: 'CANCEL' },
                { title: 'Eliminar', name: 'DELETE' },
            ],
            /*end parameters*/

            /*dialogs*/
            dialog_calendar: false,
            dialog_event: false,
            dialog_start_hour: false,
            dialog_end_hour: false,
            dialog_calendar_edit: false,
            dialog_event_edit: false,
            edit_dialog_start_hour: false,
            edit_dialog_end_hour: false,

            /*end dialogs*/

            /*fields*/
            start_time: null,
            end_time: null,
            client: null,
            selected_date: new Date().toISOString().substr(0, 10),
            event_type: null,
            user: null,
            event_description: null,
            event_date: null,
            /*end fields*/

            /*edit fields*/
            selected_date_edit: null,
            edit_event_type: null,
            edit_client: [],
            edit_end_time: null,
            edit_start_time: null,
            edit_event_description: null,
            edit_user: [],
            /*end edit fields*/

            /*edited object*/
            editedItem: {
                event_type: [],
                client: [],
                date: null,
                start_hour: null,
                end_hour: null,
                description: '',
                employees: []
            },
            /*end edited object*/

            /*rules*/
            requiredRule: [
                (v) => !!v || 'Campo requerido',
            ],
            /*end rules*/

            /*snackbar*/
            snackbar: false,
            snackbar_text: '',
            snackbar_color: '',
            y: 'vertical',
            x: null,
            mode: '',
            timeout: 3000,
            /*end snackbar*/
        },
        created: function () {
            this.OnSSE();
        },
        mounted: function () {
            this.getCompanyHours();
            this.getEventTypes();
        },
        watch: {
            search(val) {
                // Items have already been loaded
                if (this.clients.length > 0) return
                this.isLoading = true
                this.getClients();
            },

            searchUsers(val) {
                // Items have already been loaded
                if (this.users.length > 0) return
                this.isLoading = true
                this.getUsers();
            }
        },

        methods: {
            prepareParams(method) {
                const params = new URLSearchParams();
                if (method === 'POST') {
                    params.append('date', this.event_date);
                    params.append('start_hour', this.start_time);
                    params.append('end_hour', this.end_time);
                    params.append('description', this.event_description);
                    params.append('event_type', this.event_type);
                    params.append('client', this.client);
                    params.append('employees', this.user); /*M2M*/
                }
                else if (method === 'PATCH') {
                    params.append('date', this.editedItem.date);
                    params.append('start_hour', this.editedItem.start_hour);
                    params.append('end_hour', this.editedItem.end_hour);
                    params.append('description', this.editedItem.description);
                    params.append('event_type', this.editedItem.event_type);
                    params.append('client', this.editedItem.client);
                    params.append('status', this.editedItem.status);
                    params.append('employees', this.editedItem.employees); /*M2M*/
                }
                return params;
            },

            successMessage(text, color) {
                this.resetForm();
                if (this.dialog_event) this.dialog_event = false;
                if (this.dialog_event_edit) this.dialog_event_edit = false;
                this.snackbar = true;
                this.snackbar_text = text;
                this.snackbar_color = color;
            },

            errorMessage(error) {
                this.snackbar = true;
                this.snackbar_text = 'Status : ' + error.response.status + ' Message : ' + error.response.statusText;
                this.snackbar_color = 'error';
            },

            successAction(method, response) {
                this.getCompanyHours();
            },

            getCompanyHours() {
                this.$refs.dialog.save(this.selected_date);
                var params = {
                    start_date: this.selected_date
                }
                axios.get(urlSchedule, { params }).then(response => {
                    this.work_days = response.data;
                }).catch(error => {
                    this.errorMessage(error);
                });
            },

            getClients() {
                axios.get(urlClients).then(response => {
                    this.clients = response.data;
                }).catch(err => {
                    console.log(err);
                }).finally(() => (this.isLoading = false));
            },

            getEventTypes() {
                axios.get(urlEventType).then(response => {
                    this.event_types = response.data;
                }).catch(err => {
                    console.log(err);
                })
            },

            getUsers() {
                axios.get(urlUsers).then(response => {
                    this.users = response.data;
                }).catch(err => {
                    console.log(err);
                }).finally(() => (this.isLoading = false));
            },

            saveEvent() {
                if (this.valid) {
                    let method = 'POST';
                    axios.post(urlEvents, this.prepareParams(method)).then(response => {
                        // this.successMessage('Creación exitosa', 'success');
                        // this.successAction(method, response);
                    }).catch(error => {
                        this.errorMessage(error);
                    });
                }
                else {
                    alert('Favor de verificar el formulario');
                }
            },

            deleteEvent(id) {
                var result = confirm('Estas seguro de eliminar este elemento?');
                if (result) {
                    if (id != undefined) {
                        axios.delete(urlEvents + id + '/').then(response => {
                            // this.successMessage('Eliminación exitosa', 'success');
                            // this.successAction();
                        }).catch(error => {
                            this.errorMessage(error);
                        });
                    }
                }
                else {
                    console.log('delete cancelled');
                }
            },

            ShowDialogEvents(event_date) {
                this.event_date = event_date;
                this.dialog_event = true;
            },

            EventAction(action, event) {
                if (action === "DELETE") {
                    this.deleteEvent(event.id);
                }
                else if (action === "EDIT") {
                    this.dialog_event_edit = true;
                    this.getUsers();
                    this.getClients();
                    let employees = [];

                    for (var i = 0; i < event.employees.length; i++) {
                        employees.push(event.employees[i].id);
                    }
                    this.selected_date_edit = event.date;

                    let event_obj = {
                        'id': event.id,
                        'event_type': event.event_type.id,
                        'client': event.client.id,
                        'date': this.selected_date_edit,
                        'start_hour': event.start_hour,
                        'end_hour': event.end_hour,
                        'description': event.description,
                        'employees': employees,
                        'status': event.status.id
                    }

                    this.editedItem = Object.assign({}, event_obj)
                }
                else if (action === "CANCEL") {
                    console.log('hey hacer un update con status cancel');
                    let employees = [];
                    for (var i = 0; i < event.employees.length; i++) {
                        employees.push(event.employees[i].id);
                    }
                    this.selected_date_edit = event.date;
                    let event_obj = {
                        'id': event.id,
                        'event_type': event.event_type.id,
                        'client': event.client.id,
                        'date': this.selected_date_edit,
                        'start_hour': event.start_hour,
                        'end_hour': event.end_hour,
                        'description': event.description,
                        'employees': employees,
                        'status': 5
                    }
                    this.editedItem = Object.assign({}, event_obj)
                    this.updateEvent();
                }
                else {
                    console.log('ACTION NOT HANDLED');
                }
            },            

            updateEvent() {
                let method = 'PATCH';
                this.editedItem.date = this.selected_date_edit;
                axios.patch(urlEvents + this.editedItem.id + '/', this.prepareParams(method)).then(response => {
                    // this.successMessage('Actualización exitosa', 'success');
                    // this.successAction(method, response);
                }).catch(error => {
                    this.errorMessage(error);
                });
            },

            OnSSE() {
                var es = new ReconnectingEventSource('/events/');
                this.sse = es;

                this.sse.addEventListener('message', ({ data }) => {
                    let json_data = JSON.parse(data);
                    let notification = json_data.notification;
                    this.getCompanyHours();
                    if (json_data.data === "DELETE") {
                        this.successMessage(notification, 'warning');
                    }
                    else { /*CREATE AND UPDATE*/
                        json_data = JSON.parse(json_data.data);
                        this.successMessage(notification, 'success');
                    }
                }, false);
            },

            resetForm() {
                this.$refs.form.reset();
                this.$refs.event_type.focus();
            },
        }
    });
</script>
{% endblock vuescript %}